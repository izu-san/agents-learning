# ホテル予約サイト E2Eテスト観点表（たたき台）

目的：ユーザーが「ホテルを検索して予約を確定し、予約内容を確認・取消できる」ことを、主要ブラウザ（PC/スマホ）で継続的に保証する。

## 前提（E2Eの範囲）
- E2Eは「ユーザージャーニー（画面〜サーバ〜DB）」の成立を保証する（入力バリデーション網羅は別レイヤーへ）。
- 外部連携：なし（決済/メール等がある場合は「任意」行を必要に応じて有効化）。

## 優先度の定義
- P0：毎PR（最低でも毎日）で回す。壊れると即致命的。
- P1：毎日〜リリース前に回す。主要分岐・重要周辺。
- P2：必要時（仕様変更や障害対応時）。レアケース/高コスト。

## 観点表
列の意味：
- シナリオ：前提→操作→期待結果（ユーザーの目的ベース）
- データ：必要なテストデータ（ホテル/部屋/料金/在庫/会員など）
- 観測点：画面だけでなく「予約一覧に出る」などの結果指標

|ID|優先度|カテゴリ|シナリオ（前提→操作→期待結果）|主なデータ|観測点（期待結果の具体）|備考/安定化メモ|
|---:|:---:|---|---|---|---|---|
|A-01|P0|会員登録|新規会員登録→ログインできる|未登録メール/電話|登録完了画面、ログイン後のマイページ表示|CAPTCHA等がある場合はテスト用無効化/回避が必要|
|A-02|P0|認証|ログイン→ログアウト→再アクセスで未ログインになる|既存会員|ログアウト後に保護ページへ直アクセス不可|セッション切れ/CSRF等はP1へ|
|A-03|P1|認証|パスワード変更（ログイン中）→再ログインできる|既存会員|旧PW不可、新PW可|メール再設定があるなら別行に|
|S-01|P0|検索|日付/人数で検索→検索結果が出る|販売中ホテル/料金|検索結果の件数>0、価格/空室表示|日付は固定（未来日）・テストデータを固定化|
|S-02|P0|検索→詳細|検索結果→ホテル詳細→部屋/プランを選べる|複数部屋/プラン|詳細で在庫/料金が表示され選択可能|UI差分が大きい場合はセレクタを堅牢に|
|B-01|P0|予約（ゲスト）|未ログインで予約開始→ゲスト情報入力→予約確定|在庫あり、ゲスト情報|予約確認→確定完了、予約番号発行|予約の「二重送信防止」もここで見る|
|B-02|P0|予約|ログイン済で予約→情報入力→確定|既存会員、在庫あり|完了画面、マイページ予約一覧に反映|「反映が非同期」なら待ち条件を工夫|
|B-02b|P1|予約（分岐）|ゲスト予約中に「会員登録する」を選択→登録完了→予約確定|在庫あり、未登録メール|登録完了、予約確定、予約が会員に紐付く|仕様により「予約後登録」になる場合は次行を採用|
|B-02c|P1|予約（分岐）|ゲスト予約確定→後から会員登録→予約履歴が取り込まれる/照会できる|在庫あり、予約番号（またはメール）|会員の予約一覧に反映（または予約照会が可能）|「取り込み」が無い仕様なら削除|
|B-03|P1|予約分岐|クーポン適用（ある場合）→割引が反映され確定できる|割引クーポン|合計金額の変更、予約にクーポン情報保持|クーポンが無ければ削除|
|B-04|P1|予約例外|在庫切れ（または他者が確保）→適切にエラー/再検索へ誘導|在庫0/競合シナリオ|確定できない、メッセージ、回復導線|競合は難しいので擬似的に在庫0データで代替も可|
|M-01|P0|マイページ|予約一覧→予約詳細を開ける|予約済み会員|一覧に予約が表示、詳細に日付/人数/金額|テストで作った予約を追跡できる仕組みが必要|
|M-02|P0|取消|予約取消→一覧から消える/取消ステータスになる|取消可能予約|取消完了、ステータス更新|取消ポリシーで不可の場合は別ケース|
|M-03|P1|変更|日程変更（機能がある場合）→差額/在庫が正しく反映|変更可能予約|変更完了、詳細が更新|無ければ削除|
|N-01|P1|非機能/UX|スマホ表示で検索→予約まで完走できる|同上|主要導線が折れない（操作可）|Playwrightデバイスエミュレーションで実施|
|N-02|P1|アクセシビリティ|主要フォームがキーボード操作で完走できる|同上|フォーカス移動、必須入力の通知|厳密なWCAG監査は別途、E2Eは最低限|
|E-01|P2|障害耐性|検索APIが失敗→エラー表示とリトライ導線|擬似的5xx|致命的クラッシュなし、再試行可能|ネットワークモックで実施するならE2E/統合の境界調整|
|P-01|P2|性能スモーク|検索結果が一定時間内に表示|同上|例：LCP/表示完了が閾値以内|環境ブレが大きいのでCIでは緩め/任意|
|Q-01|P1|コンテンツ品質|主要画面で重要画像が壊れていない（404でない）|検索結果、詳細|imgタグのロード完了、naturalWidth > 0|画像CDN障害の検知に役立つ|
|Q-02|P2|SEO|TOP/詳細ページのmetaタグが出力されている|各ページ|title, description, canonicalが存在、noindexが無い|SEO事故防止（特に本番相当環境で重要）|
|U-01|P2|ブラウザ操作|予約入力確認画面からブラウザバック→入力画面に戻る|入力途中データ|フォーム値が保持されている、エラー画面にならない|SPAや遷移制御のリグレッション検知|
|L-01|P2|法的・規約|フッターの利用規約・特商法リンクが生きている|静的ページ|クリックして遷移可、ステータス200|法務リスク回避（リンク切れ監視）|
|X-01|任意|決済|事前決済（ある場合）成功→予約確定|テストカード|決済成功・予約確定|外部連携がある場合はサンドボックス/スタブ方針が必要|
|X-02|任意|通知|予約完了メール（ある場合）→内容が正しい|テストメールボックス|メール受信・予約番号一致|外部連携がある場合のみ|

