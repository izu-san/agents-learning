# HOTEL PLANISPHERE E2Eテスト計画

## Application Overview

HOTEL PLANISPHERE 日本語サイトの主要機能（ナビゲーション、会員登録、ログイン、宿泊プラン一覧、予約、予約確認/完了、マイページ）に対するE2Eテスト計画。未ログイン/一般会員/プレミアム会員での表示差分と、フォームバリデーション・動的表示・価格計算を重点検証する。

## Test Scenarios

### 1. ナビゲーション/ホーム

**Seed:** `tests/seed.spec.ts`

#### 1.1. ホームページ初期表示と主要リンクの導線

**File:** `tests/navigation/home.spec.ts`

**Steps:**
  1. -
    - expect: ホームが表示され、サイト名とグローバルナビ（ホーム/宿泊予約/会員登録/ログイン）が表示される。
    - expect: お知らせに外部リンクが表示される。
  2. ナビの「宿泊予約」をクリックする。
    - expect: 宿泊プラン一覧へ遷移する。
  3. ブラウザバックでホームに戻る。
    - expect: ホームが再表示される。
  4. ナビの「会員登録」をクリックする。
    - expect: 会員登録ページへ遷移する。
  5. ブラウザバックでホームに戻る。
    - expect: ホームが再表示される。
  6. ナビの「ログイン」をクリックする。
    - expect: ログインページへ遷移する。

### 2. 認証（ログイン/ログアウト）

**Seed:** `tests/seed.spec.ts`

#### 2.1. 既存会員でログイン成功→マイページ表示

**File:** `tests/auth/login-success.spec.ts`

**Steps:**
  1. ログインページでメールアドレスに既存ユーザー（例: ichiro@example.com）を入力する。
    - expect: 入力値が反映される。
  2. パスワードに有効な値（例: password）を入力してログインする。
    - expect: マイページへ遷移し、メールアドレス/氏名/会員ランク等が表示される。
    - expect: ナビに「マイページ」「ログアウト」が表示される。

#### 2.2. ログイン失敗（未入力/不正値）

**File:** `tests/auth/login-validation.spec.ts`

**Steps:**
  1. メールアドレス・パスワード未入力のままログインを試行する。
    - expect: ログインが失敗し、画面遷移しない。エラー表示またはバリデーションが表示される。
  2. 存在しないメールアドレス/誤ったパスワードでログインを試行する。
    - expect: ログインが失敗し、画面遷移しない。エラー表示またはバリデーションが表示される。

#### 2.3. ログアウト

**File:** `tests/auth/logout.spec.ts`

**Steps:**
  1. 有効な会員でログイン済みの状態にする。
    - expect: マイページが表示される。
  2. ナビの「ログアウト」をクリックする。
    - expect: 未ログイン状態に戻り、ナビが「ログイン/会員登録」に戻る。

### 3. 会員登録

**Seed:** `tests/seed.spec.ts`

#### 3.1. 会員登録の正常系（必須項目のみ）

**File:** `tests/signup/signup-success-min.spec.ts`

**Steps:**
  1. 会員登録ページで必須項目（メール、パスワード、パスワード確認、氏名、会員ランク）を有効値で入力する。
    - expect: 入力値が反映される。
  2. 登録を実行する。
    - expect: 登録が完了し、ログイン可能な状態になる。
  3. 登録したメール/パスワードでログインする。
    - expect: マイページに登録情報が表示される。

#### 3.2. 会員登録の正常系（任意項目含む）

**File:** `tests/signup/signup-success-full.spec.ts`

**Steps:**
  1. 必須項目に加えて住所/電話番号/性別/生年月日/お知らせ受信を入力する。
    - expect: 入力値が反映される。
  2. 登録を実行してログインする。
    - expect: マイページに任意項目の内容が反映される。

#### 3.3. 会員登録のバリデーション

**File:** `tests/signup/signup-validation.spec.ts`

**Steps:**
  1. 必須項目を未入力で登録を試行する。
    - expect: 登録が失敗し、必須項目のバリデーションが表示される。
  2. パスワードを8文字未満にして登録を試行する。
    - expect: 登録が失敗し、パスワード長のバリデーションが表示される。
  3. パスワードと確認が不一致の状態で登録を試行する。
    - expect: 登録が失敗し、不一致のバリデーションが表示される。
  4. 電話番号に数字以外/11桁以外を入力して登録を試行する。
    - expect: 登録が失敗し、電話番号形式のバリデーションが表示される。
  5. 生年月日に不正形式を入力して登録を試行する。
    - expect: 登録が失敗し、生年月日形式のバリデーションが表示される。

### 4. 宿泊プラン一覧

**Seed:** `tests/seed.spec.ts`

#### 4.1. 未ログインのプラン一覧表示

**File:** `tests/plans/plans-guest.spec.ts`

**Steps:**
  1. 未ログイン状態で宿泊プラン一覧を開く。
    - expect: おすすめプランと一般向けプランのみが表示される。
    - expect: 会員限定/プレミアム会員限定の表示はない。
  2. 各プランの「このプランで予約」リンクを確認する。
    - expect: reserve.html?plan-id=XX が設定されている。

#### 4.2. 一般会員のプラン一覧表示

**File:** `tests/plans/plans-standard.spec.ts`

**Steps:**
  1. 一般会員でログインし、宿泊プラン一覧を開く。
    - expect: 会員限定プランが表示される。
    - expect: プレミアム会員限定プランは表示されない。

#### 4.3. プレミアム会員のプラン一覧表示

**File:** `tests/plans/plans-premium.spec.ts`

**Steps:**
  1. プレミアム会員でログインし、宿泊プラン一覧を開く。
    - expect: 会員限定プランとプレミアム会員限定プランの両方が表示される。

### 5. 宿泊予約

**Seed:** `tests/seed.spec.ts`

#### 5.1. 予約フォームの初期表示と必須項目

**File:** `tests/reservation/reserve-form-basics.spec.ts`

**Steps:**
  1. 任意のプランから予約画面を開く。
    - expect: 宿泊日/宿泊数/人数/氏名/確認のご連絡が必須で表示される。
    - expect: 合計金額が初期表示される。
  2. 確認のご連絡を「メールでのご連絡」に変更する。
    - expect: メールアドレス入力欄が表示され必須になる。
  3. 確認のご連絡を「電話でのご連絡」に変更する。
    - expect: 電話番号入力欄が表示され必須になる。
  4. 確認のご連絡を「希望しない」に変更する。
    - expect: メール/電話の入力欄が非表示になる。

#### 5.2. 予約フォームのバリデーション

**File:** `tests/reservation/reserve-validation.spec.ts`

**Steps:**
  1. 必須項目未入力のまま「予約内容を確認する」を押す。
    - expect: 遷移せず、必須項目のバリデーションが表示される。
  2. 宿泊日を3ヶ月外の日付に変更して送信する。
    - expect: 送信が失敗し、日付範囲のバリデーションが表示される。
  3. 宿泊数を0、または許容上限超に設定して送信する。
    - expect: 送信が失敗し、宿泊数のバリデーションが表示される。
  4. 人数を0、または許容上限超に設定して送信する。
    - expect: 送信が失敗し、人数のバリデーションが表示される。
  5. カップル限定プランで人数1を指定して送信する。
    - expect: 送信が失敗し、最小人数のバリデーションが表示される。

#### 5.3. 料金計算の動的更新

**File:** `tests/reservation/price-calculation.spec.ts`

**Steps:**
  1. 宿泊数・人数を変更する。
    - expect: 合計金額が変更内容に応じて更新される。
  2. 追加プラン（朝食/昼からチェックイン/観光）をON/OFFする。
    - expect: 合計金額がオプション追加/解除に応じて更新される。
  3. 土日を含む宿泊日に変更する。
    - expect: 週末料金の加算が反映される。

#### 5.4. 予約確認→予約完了ダイアログ

**File:** `tests/reservation/confirm-and-complete.spec.ts`

**Steps:**
  1. 予約フォームに有効値を入力し「予約内容を確認する」を押す。
    - expect: 予約確認画面へ遷移し、入力内容が要約表示される。
  2. 「この内容で予約する」を押す。
    - expect: 完了ダイアログが表示される。
  3. ダイアログの「閉じる」またはCloseを押す。
    - expect: ダイアログが閉じ、画面操作が可能になる。

### 6. マイページ

**Seed:** `tests/seed.spec.ts`

#### 6.1. マイページの表示内容（既存会員）

**File:** `tests/mypage/mypage-existing.spec.ts`

**Steps:**
  1. 既存会員でログインする。
    - expect: マイページに登録情報が表示される。
    - expect: 既存会員は「アイコン設定」「退会する」が無効（disabled）で表示される。

#### 6.2. 新規会員のアイコン設定と退会

**File:** `tests/mypage/mypage-new-user.spec.ts`

**Steps:**
  1. 新規会員を会員登録してログインする。
    - expect: マイページに登録情報が表示される。
    - expect: 「アイコン設定」「退会する」が有効で表示される。
  2. アイコン設定を行い保存する。
    - expect: アイコンがマイページに反映される。
  3. 退会するを実行する。
    - expect: ユーザー情報が削除され、未ログイン状態に戻る。
