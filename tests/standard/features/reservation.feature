Feature: 宿泊予約

	@reservation @visual @smoke
	Scenario: 予約フォーム基本操作と料金計算
		Given 新しいブラウザ状態で任意プランの予約画面を開く
		Then 予約フォームの主要項目が表示される
		And 合計金額が初期値で表示される
		And 画面全体のビジュアルスナップショットを保存・比較する
		When 宿泊数・人数・追加プランを変更する
		Then 合計金額が入力に応じて更新される
		When 土日を含む日付に変更する
		Then 週末料金の加算が反映される

	@reservation @negative
	Scenario: 予約フォームの必須・範囲エラー
		Given 新しいブラウザ状態で予約画面を開く
		When 氏名未入力・連絡方法未選択で「予約内容を確認する」を押す
		Then 予約画面のままである
		And 必須入力のエラーが表示される
		When 宿泊日を許容範囲外に設定する
		Then 日付に関するバリデーションが表示される
		When 宿泊数・人数を許容範囲外に設定する
		Then 範囲外エラーが表示される

	@reservation
	Scenario: 連絡方法による入力切替
		Given 新しいブラウザ状態で予約画面を開く
		When 「メールでのご連絡」を選択する
		Then メールアドレス入力欄が表示され必須になる
		When 「電話でのご連絡」を選択する
		Then 電話番号入力欄が表示され必須になる

	@reservation @new-field @optional
	Scenario: 【追加】性別・年齢の表示と入力（任意項目）
		Given 新しいブラウザ状態で任意プランの予約画面を開く
		Then 【追加】予約フォームの性別セレクトが表示され初期値が未回答である
		And 【追加】予約フォームの年齢の入力欄が表示される
		When 【追加】性別と年齢を入力し「予約内容を確認する」を押す
		Then 【追加】確認画面に性別・年齢の入力内容が表示される
		When 【追加】性別と年齢を未入力のまま有効な値で予約確認へ進む
		Then 予約確認へ進める

	@reservation @boundary
	Scenario: 料金計算の境界値（人数/泊数の最小・最大）
		Given 新しいブラウザ状態で任意プランの予約画面を開く
		When 人数・宿泊数を最小値に設定する
		Then 合計金額が最小条件に一致する
		When 人数・宿泊数を最大値に設定する
		Then 合計金額が最大条件に一致する

	@reservation @regression
	Scenario: 連打・二重送信防止
		Given 新しいブラウザ状態で予約フォームを有効な値で入力する
		When 「予約内容を確認する」を連打する
		Then 確認画面への遷移が一度だけ行われる

	@reservation @boundary @negative
	Scenario: 【追加】年齢入力の境界と形式
		Given 新しいブラウザ状態で任意プランの予約画面を開く
		Then 【追加】予約フォームの年齢の入力欄が表示される
		When 【追加】年齢に負数、極端に大きい数値、または小数を入力する
		Then 【追加】許容されない値はエラー表示または入力制限が働く
		When 【追加】年齢に空、0、または最小許容値を入力して確認へ進む
		Then 【追加】仕様に従って受理またはエラー表示される
